<!DOCTYPE html>
<html>
  <head>
    <title>Random City Generator</title>
    <style>
      #cityCanvas {
        border: 1px solid #000;
      }
    </style>
  </head>
  <body>
    <canvas id="cityCanvas" width="800" height="500"></canvas>

    <script>
      const canvas = document.getElementById('cityCanvas');
      const canvasWidth = canvas.width;
      const canvasHeight = canvas.height;

      // Function to generate a random number within a range
      function getRandomNumber(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      // Function to generate a random city
      function generateRandomCity(cityLength, cityHeight, minBuildingHeight, maxBuildingHeight, subwayHeight, minBuildingWidth, maxBuildingWidth, minBuildingDistance, maxBuildingDistance) {
        // Array to store the city layout
        var cityLayout = [];

        // Put the road in the middle
        const roadPosition = cityHeight - subwayHeight - 1

        const buildings = []

        // Prepare building width dimensions
        let position = 0
        for (; position < cityLength; position += getRandomNumber(minBuildingDistance, maxBuildingDistance)) {
          // Generate a random building width
          let width = getRandomNumber(minBuildingWidth, maxBuildingWidth)

          if (width % 2 === 1) {
            // Don't allow odd number building widths, this makes elevator generation easier
            width += 1
          }

          if (position + width > cityLength) {
            // The next buidling size is out of bounds of the city
            if (cityLength - position < minBuildingWidth ) {
              // stretch the last building to the end
              const building = buildings[buildings.length - 1]
              building[1] = cityLength - building[0]
              position = cityLength
            }
            break
          }

          // Add the building to the queue
          buildings.push([position, width])
          position += width
        }

        if (position < cityLength) {
          // If there is a gap, fill it with a building
          buildings.push([position, cityLength - position])
        }

        // Generate the road
        var road = {
          type: 'road',
          x: 0,
          y: roadPosition,
          width: cityLength,
          height: 1
        };
        cityLayout.push(road);

        // Generate the subway
        var subway = {
          type: 'subway',
          x: 0,
          y: roadPosition + 1,
          width: cityLength,
          height: subwayHeight
        };
        cityLayout.push(subway);

        const actualMaxBuildingHeight = maxBuildingHeight > cityHeight
          ? cityHeight
          : maxBuildingHeight

        // Generate the buildings
        for (const buildingData of buildings) {
          const buildingHeight = getRandomNumber(minBuildingHeight, actualMaxBuildingHeight);
		      const x = buildingData[0]
          const buildingWidth = buildingData[1]

          const building = {
            type: 'building',
            x: x,
            y: roadPosition - buildingHeight,
            width: buildingWidth,
            height: buildingHeight
          };
          cityLayout.push(building);

          // Generate the connecting rectangle to the subway
          console.log(building.x + (buildingWidth / 2))
          const elevator = {
            type: 'elevator',
            x: building.x + (buildingWidth / 2),
            y: roadPosition - buildingHeight,
            width: 1,
            height: buildingHeight + subwayHeight
          };
          cityLayout.push(elevator);

          for (let roomId = 0; roomId < building.height; roomId++) {
            const leftRoom = {
              type: 'room',
              x: building.x + 1,
              y: roadPosition - buildingHeight + roomId,
              width: buildingWidth / 2 - elevator.width ,
              height: 1
            };
            cityLayout.push(leftRoom);

            const rightRoom = {
              type: 'room',
              x: elevator.x + elevator.width + 0.5,
              y: roadPosition - buildingHeight + roomId,
              width: buildingWidth / 2 - elevator.width ,
              height: 1
            };
            cityLayout.push(rightRoom);
          }
        }



        return cityLayout;
      }

      // Draw the city layout on the canvas
      function drawCityLayout(cityLayout, pixelPerUnit) {
        var ctx = canvas.getContext('2d');

        const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);

        // Define the gradient colors
        gradient.addColorStop(0, 'rgb(64, 0, 64)');        // Dark purple
        gradient.addColorStop(0.5, 'rgb(255, 102, 0)');    // Sunset blaze
        gradient.addColorStop(1, 'rgb(255, 204, 153)');    // Light orange

        // Fill the canvas with the gradient
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        for (var i = 0; i < cityLayout.length; i++) {
          var shape = cityLayout[i];
          let offsetHeight = 0
          let offsetWidth = 0

          switch (shape.type) {
            case 'road':
              ctx.fillStyle = '#242629';
              break;
            case 'building':
              ctx.fillStyle = '#5B6A7A';
              break;
            case 'elevator':
              ctx.fillStyle = '#F8DF9D';
              break;
            case 'subway':
              ctx.fillStyle = '#903642';
              break;
            case 'room':
              ctx.fillStyle = '#BDAFEE';
              offsetHeight = 1
              offsetWidth = 1
              break;
            
          }

          ctx.fillRect(
            shape.x * pixelPerUnit - offsetWidth * 2,
            shape.y * pixelPerUnit + offsetHeight,
            shape.width * pixelPerUnit - offsetWidth,
            shape.height * pixelPerUnit - offsetHeight 
          );
        }
      }

      // Example usage
      const metersPerUnit = 1
      const pixelPerUnit = 20
      const cityLength = canvasWidth / pixelPerUnit
      const cityHeight = canvasHeight / pixelPerUnit
      const minBuildingHeight = 100;
      const maxBuildingHeight = 120;
      const minBuildingWidth = 15
      const maxBuildingWidth = 30
      const minBuildingDistance = 0
      const maxBuildingDistance = 0
      const subwayHeight = 6;
      

      document.addEventListener('DOMContentLoaded', function() {
        var randomCity = generateRandomCity(cityLength, cityHeight, minBuildingHeight, maxBuildingHeight, subwayHeight, minBuildingWidth, maxBuildingWidth, minBuildingDistance, maxBuildingDistance);
        drawCityLayout(randomCity, pixelPerUnit);
      });
    </script>
  </body>
</html>

